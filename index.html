<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Alabraj</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; direction: rtl; padding: 20px; }
    .controls { margin-bottom: 16px; }
    button { margin-left: 6px; padding: 8px 12px; }
    #exportCsvBtn, #clearAllBtn { display: none; }
    .admin-indicator { margin-right: 8px; color: green; font-weight: bold; display: none; }
  </style>
</head>
<body>
  <h1>قائمة البيانات</h1>

  <div class="controls">
    <span id="adminIndicator" class="admin-indicator">مسؤول مُسجّل</span>
    <button id="adminBtn">Admin</button>
    <button id="exportCsvBtn">تصدير CSV</button>
    <button id="clearAllBtn">مسح الكل</button>
  </div>

  <table id="dataTable" border="1" cellpadding="6">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>البريد</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>أحمد</td><td>ahmed@example.com</td></tr>
      <tr><td>ليلى</td><td>layla@example.com</td></tr>
    </tbody>
  </table>

  <script>
    // ADMIN PASSWORD - Change this to a strong password before deploying!
    // NOTE: This is a client-side password check for convenience only. For real security, implement server-side authentication.
    const ADMIN_PASSWORD = 'admin123'; // <-- CHANGE THIS

    const adminBtn = document.getElementById('adminBtn');
    const exportBtn = document.getElementById('exportCsvBtn');
    const clearBtn = document.getElementById('clearAllBtn');
    const adminIndicator = document.getElementById('adminIndicator');

    function isAdmin() {
      return sessionStorage.getItem('isAdmin') === 'true';
    }

    function setAdminSession(val) {
      if (val) {
        sessionStorage.setItem('isAdmin', 'true');
      } else {
        sessionStorage.removeItem('isAdmin');
      }
      updateUiForAdmin();
    }

    function updateUiForAdmin() {
      if (isAdmin()) {
        exportBtn.style.display = '';
        clearBtn.style.display = '';
        adminIndicator.style.display = '';
        adminBtn.textContent = 'Logout Admin';
      } else {
        exportBtn.style.display = 'none';
        clearBtn.style.display = 'none';
        adminIndicator.style.display = 'none';
        adminBtn.textContent = 'Admin';
      }
    }

    adminBtn.addEventListener('click', function() {
      if (isAdmin()) {
        if (confirm('تسجيل الخروج كمسؤول؟')) {
          setAdminSession(false);
        }
        return;
      }

      const pw = prompt('أدخل كلمة مرور المسؤول:');
      if (pw === null) return; // user cancelled
      if (pw === ADMIN_PASSWORD) {
        setAdminSession(true);
        alert('تم تسجيل الدخول كمسؤول. الآن يمكنك رؤية واستخدام أزرار التصدير والمسح.');
      } else {
        alert('كلمة المرور غير صحيحة.');
      }
    });

    function requireAdminAction(action) {
      if (!isAdmin()) {
        alert('الإجراء محمي. الرجاء تسجيل الدخول كمسؤول للوصول.');
        return false;
      }
      return true;
    }

    function exportCsv() {
      if (!requireAdminAction('export')) return;

      const rows = [];
      const trs = document.querySelectorAll('#dataTable tbody tr');
      trs.forEach(tr => {
        const cols = Array.from(tr.children).map(td => '"' + (td.textContent || '').replace(/"/g, '""') + '"');
        rows.push(cols.join(','));
      });
      const csvContent = rows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'export.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function clearAll() {
      if (!requireAdminAction('clear')) return;

      if (!confirm('هل أنت متأكد من مسح كل البيانات؟ لا يمكن التراجع عن هذا الإجراء.')) return;
      const tbody = document.querySelector('#dataTable tbody');
      while (tbody.firstChild) tbody.removeChild(tbody.firstChild);
      alert('تم مسح كل البيانات.');
    }

    exportBtn.addEventListener('click', exportCsv);
    clearBtn.addEventListener('click', clearAll);

    // Protect functions in case someone tries to call them from console or other scripts.
    window.__protectedAdmin = {
      exportCsv: function() { if (isAdmin()) return exportCsv(); alert('محمي: تسجيل الدخول كمسؤول مطلوب.'); },
      clearAll: function() { if (isAdmin()) return clearAll(); alert('محمي: تسجيل الدخول كمسؤول مطلوب.'); }
    };

    // Initialize UI based on sessionStorage
    document.addEventListener('DOMContentLoaded', updateUiForAdmin);

  </script>
</body>
</html>
