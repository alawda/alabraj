<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام تحديث بيانات سكان أبراج العودة</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #22c55e;
      --secondary: #06b6d4;
      --bg: #0f172a;
      --card-bg: rgba(30, 41, 59, 0.8);
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --border: rgba(255, 255, 255, 0.1);
      --input-bg: #0b1324;
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      background-color: #0f172a;
      background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
      /* الحل الجذري للمربعات: إضافة خطوط النظام العربية الشهيرة كاحتياط */
      font-family: 'Cairo', 'Simplified Arabic', 'Tahoma', 'Arial', sans-serif;
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
      direction: rtl;
    }

    .container { max-width: 950px; margin: 0 auto; padding: 20px; }
    .header-section { text-align: center; margin-bottom: 30px; }
    .title {
      font-size: clamp(1.5rem, 5vw, 2.2rem);
      font-weight: 800;
      background: linear-gradient(to left, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .card-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }

    form { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .field { display: flex; flex-direction: column; gap: 5px; }
    .field.full { grid-column: 1 / -1; }

    label { font-size: 14px; font-weight: bold; color: #cbd5e1; }
    input, select, textarea {
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      color: white;
      font-family: inherit;
    }

    .actions { padding: 20px; display: flex; flex-wrap: wrap; gap: 10px; background: rgba(0,0,0,0.2); }
    .btn { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; font-family: inherit; }
    .btn-primary { background: var(--primary); color: #052e16; }
    .btn-secondary { background: #1e293b; color: white; border: 1px solid var(--border); }
    .btn-danger { background: #7f1d1d; color: white; }

    #adminSection { display: none; margin-top: 20px; }
    .table-container { padding: 15px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 900px; font-size: 13px; }
    th { background: rgba(255,255,255,0.05); color: var(--secondary); padding: 10px; text-align: right; border-bottom: 2px solid var(--border); }
    td { padding: 10px; border-bottom: 1px solid var(--border); }

    @media (max-width: 768px) { form { grid-template-columns: 1fr; } }
    @media print {
      body * { visibility: hidden; }
      #adminSection, #adminSection * { visibility: visible; }
      #adminSection { position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; }
      table, th, td { border: 1px solid black !important; color: black !important; }
      .btn, .card-header { display: none !important; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header-section">
      <h1 class="title">لجنة حي أبراج العودة - بيت حانون</h1>
      <p style="color: var(--text-muted)">نموذج تحديث بيانات سكان أبراج العودة الرقمي</p>
    </div>

    <div class="card">
      <div class="card-header">
        <span>نموذج التحديث</span>
        <button type="button" class="btn-secondary" id="adminToggle" style="padding: 5px 10px; font-size: 12px;">دخول الإدارة</button>
      </div>

      <form id="mainForm">
        <div class="field full"><label>الاسم الرباعي</label><input type="text" id="fullName" required></div>
        <div class="field"><label>تاريخ الميلاد</label><input type="date" id="birthDate" required></div>
        <div class="field"><label>عدد الأفراد</label><input type="number" id="familyCount" required></div>
        <div class="field"><label>رقم الهوية</label><input type="text" id="idNumber" maxlength="9" required></div>
        <div class="field"><label>رقم الجوال</label><input type="text" id="phone" maxlength="10" required></div>
        <div class="field"><label>اسم الزوجة</label><input type="text" id="wifeName" required></div>
        <div class="field"><label>هوية الزوجة</label><input type="text" id="wifeIdNumber" maxlength="9" required></div>
        <div class="field">
          <label>رقم البرج</label>
          <select id="tower" required><option value="">اختر...</option><script>for(let i=1;i<=8;i++)document.write(`<option>${i}</option>`)</script></select>
        </div>
        <div class="field"><label>رقم الشقة</label><input type="text" id="apartment" required></div>
        <div class="field full">
          <label>محافظة السكن الحالي</label>
          <select id="governorate" required><option value="">اختر...</option><option>غزة</option><option>شمال غزة</option><option>الوسطى</option><option>خانيونس</option><option>رفح</option></select>
        </div>
        <div class="field full"><label>العنوان التفصيلي</label><textarea id="address" rows="2" required></textarea></div>
        <div class="field full"><label>الملاحظات</label><textarea id="notes" rows="2"></textarea></div>
      </form>

      <div class="actions">
        <button type="button" class="btn btn-primary" id="saveBtn">حفظ البيانات</button>
      </div>
    </div>

    <div id="adminSection" class="card">
      <div class="card-header"><span>لوحة الإدارة (السجلات الكاملة)</span></div>
      <div class="actions">
        <button type="button" class="btn btn-secondary" id="exportBtn">تصدير CSV</button>
        <button type="button" class="btn btn-secondary" id="printBtn">طباعة التقرير</button>
        <button type="button" class="btn btn-danger" id="clearBtn">مسح الكل</button>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>الاسم</th><th>الميلاد</th><th>الأفراد</th><th>الهوية</th><th>الجوال</th><th>الزوجة</th><th>هوية الزوجة</th><th>البرج</th><th>الشقة</th><th>محافظة السكن الحالي</th><th>العنوان</th><th>الملاحظات</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <footer style="text-align:center; padding: 20px; font-size: 12px; color: var(--text-muted);">
      تطوير أبو جبريل نوفل &copy; 2026
    </footer>
  </div>

  <script>
    const PASSWORDS = ['Almojahed', 'Alhoot'];
    const KEY = 'abraj_v2_data';

    const getStore = () => JSON.parse(localStorage.getItem(KEY) || '[]');
    const setStore = (d) => localStorage.setItem(KEY, JSON.stringify(d));

    const refreshTable = () => {
      const data = getStore();
      const body = document.getElementById('tableBody');
      body.innerHTML = '';
      data.forEach(r => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.fullName}</td><td>${r.birthDate}</td><td>${r.familyCount}</td><td>${r.idNumber}</td><td>${r.phone}</td><td>${r.wifeName}</td><td>${r.wifeIdNumber}</td><td>${r.tower}</td><td>${r.apartment}</td><td>${r.governorate}</td><td>${r.address}</td><td>${r.notes || '-'}</td>`;
        body.appendChild(tr);
      });
    };

    document.getElementById('adminToggle').onclick = () => {
      const section = document.getElementById('adminSection');
      if(section.style.display === 'block') {
        section.style.display = 'none';
        document.getElementById('adminToggle').textContent = 'دخول الإدارة';
      } else {
        const p = prompt('كلمة المرور:');
        if(PASSWORDS.includes(p)) {
          section.style.display = 'block';
          document.getElementById('adminToggle').textContent = 'إغلاق الإدارة';
          refreshTable();
        } else if(p !== null) alert('خطأ');
      }
    };

    document.getElementById('saveBtn').onclick = () => {
      const form = document.getElementById('mainForm');
      if(!form.checkValidity()) return alert('أكمل البيانات');
      const entry = {
        fullName: document.getElementById('fullName').value, birthDate: document.getElementById('birthDate').value,
        familyCount: document.getElementById('familyCount').value, idNumber: document.getElementById('idNumber').value,
        phone: document.getElementById('phone').value, wifeName: document.getElementById('wifeName').value,
        wifeIdNumber: document.getElementById('wifeIdNumber').value, tower: document.getElementById('tower').value,
        apartment: document.getElementById('apartment').value, governorate: document.getElementById('governorate').value,
        address: document.getElementById('address').value, notes: document.getElementById('notes').value
      };
      const store = getStore();
      if(store.some(s => s.idNumber === entry.idNumber)) return alert('مسجل مسبقاً');
      store.push(entry);
      setStore(store);
      form.reset();
      refreshTable();
      alert('تم الحفظ');
    };

    document.getElementById('exportBtn').onclick = () => {
      const data = getStore();
      let csv = "\uFEFFالاسم,الميلاد,الأفراد,الهوية,الجوال,الزوجة,هوية الزوجة,البرج,الشقة,محافظة السكن الحالي,العنوان,الملاحظات\n";
      data.forEach(r => {
        csv += `"${r.fullName}","${r.birthDate}","${r.familyCount}","${r.idNumber}","${r.phone}","${r.wifeName}","${r.wifeIdNumber}","${r.tower}","${r.apartment}","${r.governorate}","${r.address}","${r.notes}"\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `بيانات_السكان_كاملة.csv`;
      a.click();
    };

    document.getElementById('printBtn').onclick = () => window.print();
    document.getElementById('clearBtn').onclick = () => { if(confirm('حذف الكل؟')) { setStore([]); refreshTable(); } };
  </script>
</body>
</html>